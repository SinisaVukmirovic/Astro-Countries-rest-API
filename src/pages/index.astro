---
import BaseLayout from "../layouts/BaseLayout.astro";

const results = await fetch("https://restcountries.com/v3.1/all");
const data = await results.json();
---

<BaseLayout>
	<label for="pet-select">Choose a pet:</label>

	<select name="pets" id="pet-select">
		<option value="">--Please choose an option--</option>
		<option value="dog">Dog</option>
		<option value="cat">Cat</option>
		<option value="hamster">Hamster</option>
		<option value="parrot">Parrot</option>
		<option value="spider">Spider</option>
		<option value="goldfish">Goldfish</option>
	</select>

	<input
		type="search"
		name=""
		id="search"
		placeholder="Enter Search Term.."
	/>

	<ul id="countries">
		{data.map((d) => (
			<li data-country={d.name.common}>
				<a href={`/country/${d.ccn3}`}>{d.name.common}</a>
			</li>
		))}
	</ul>
</BaseLayout>

<script>
	const searchInput = document.querySelector('#search') as HTMLInputElement;
	const countries = Array.from(document.querySelectorAll('[data-country]'));

	searchInput?.addEventListener('input', e => {
		const value = e.target?.value.toLowerCase();
		
		countries.forEach(c => {
			if (!c.dataset.country.toLowerCase().includes(value)) {
				c.classList.add('hidden');
			} else {
				c.classList.remove('hidden');
			}
		});
	});
</script>